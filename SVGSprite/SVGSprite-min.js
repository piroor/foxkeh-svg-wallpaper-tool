/*!
 * Copyright 2011, Mozilla Japan.
 * Dual licensed under the MIT or GPL Version 3 licenses.
 * https://bitbucket.org/foxkeh/svg-wallpaper-tool/src/tip/MIT-LICENSE.txt
 * https://bitbucket.org/foxkeh/svg-wallpaper-tool/src/tip/GPL-LICENSE.txt
 *
 */
(function(a){function d(a,b,c,d){!Object.prototype.__defineSetter__&&Object.defineProperty({},"x",{get:function(){return!0}}).x?Object.defineProperty(a,b,{set:c,get:d}):Object.prototype.__defineSetter__&&(a.__defineSetter__(b,c),a.__defineGetter__(b,d))}var b={CENTER:"center",TOP_LEFT:"top_left",TOP_CENTER:"top_center",TOP_RIGHT:"top_right",MIDDLE_LEFT:"middle_left",MIDDLE_CENTER:"center",MIDDLE_RIGHT:"middle_right",BOTTOM_LEFT:"bottom_left",BOTTOM_CENTER:"bottom_center",BOTTOM_RIGHT:"bottom_right"},c=function(a,b){this.sourceSVGElement=a,this.prefix=typeof a.prefix=="string"?a.prefix+":":"",this.init(b)};c.prototype.init=function(a){this.wrapper=document.createElementNS("http://www.w3.org/2000/svg",this.prefix+"g"),this.transformWrapper=document.createElementNS("http://www.w3.org/2000/svg",this.prefix+"g"),this.wrapper.setAttribute("class","Transform"),this.transformWrapper.setAttribute("class","SVGTransformWrapper"),this.sourceSVGElement.parentNode.replaceChild(this.wrapper,this.sourceSVGElement),this.wrapper.appendChild(this.transformWrapper),this.transformWrapper.appendChild(this.sourceSVGElement),this.svgElement=this.wrapper,this.origOffset={x:this.transformWrapper.getBBox().x,y:this.transformWrapper.getBBox().y},this.origWidth=this.transformWrapper.getBBox().width,this.origHeight=this.transformWrapper.getBBox().height,this._transform={x:0,y:0,scaleX:1,scaleY:1,rotate:0},this._setCenterPoint(a)},c.prototype._setCenterPoint=function(a){if(!this._x||!this._y){switch(a){case b.CENTER:a=b.CENTER;break;case b.TOP_LEFT:a=b.TOP_LEFT;break;case b.TOP_CENTER:a=b.TOP_CENTER;break;case b.TOP_RIGHT:a=b.TOP_RIGHT;break;case b.MIDDLE_LEFT:a=b.MIDDLE_LEFT;break;case b.MIDDLE_RIGHT:a=b.MIDDLE_RIGHT;break;case b.BOTTOM_LEFT:a=b.BOTTOM_LEFT;break;case b.BOTTOM_CENTER:a=b.BOTTOM_CENTER;break;case b.BOTTOM_RIGHT:a=b.BOTTOM_RIGHT;break;default:a=b.CENTER}this.centerPoint=a;var c=this.origOffset.x+this.getCX(),d=this.origOffset.y+this.getCY();this.setX(c),this.setY(d)}},c.prototype.setTransform=function(a){if(typeof a!="undefined"){var b=typeof a.x=="number"?a.x:this._transform.x,c=typeof a.y=="number"?a.y:this._transform.y,d=typeof a.scaleX=="number"?a.scaleX:this._transform.scaleX,e=typeof a.scaleY=="number"?a.scaleY:this._transform.scaleY,f=typeof a.rotate=="number"?a.rotate:this._transform.rotate,g=-this.getCX(),h=-this.getCY(),i=-this.origOffset.x,j=-this.origOffset.y;this._transform.x=b,this._transform.y=c,this._transform.scaleX=d,this._transform.scaleY=e,this._transform.rotate=f;var k="translate("+b+" "+c+") ",l="rotate("+f+") ",m="scale("+d+" "+e+") ",n="translate("+g+" "+h+") ",o="translate("+i+" "+j+") ";this.transformWrapper.setAttribute("transform",k+l+m+n+o)}},c.prototype.getWidth=function(){return this.wrapper.getBBox().width},c.prototype.getHeight=function(){return this.wrapper.getBBox().height},c.prototype.getCX=function(){var a=0,c=this.origWidth,d=c/2,e=a;switch(this.centerPoint){case b.CENTER:e=d;break;case b.TOP_LEFT:e=a;break;case b.TOP_CENTER:e=d;break;case b.TOP_RIGHT:e=c;break;case b.MIDDLE_LEFT:e=a;break;case b.MIDDLE_RIGHT:e=c;break;case b.BOTTOM_LEFT:e=a;break;case b.BOTTOM_CENTER:e=d;break;case b.BOTTOM_RIGHT:e=c;break;default:}return e},c.prototype.getCY=function(){var a=0,c=this.origHeight,d=c/2,e=a;switch(this.centerPoint){case b.CENTER:e=d;break;case b.TOP_LEFT:e=a;break;case b.TOP_CENTER:e=a;break;case b.TOP_RIGHT:e=a;break;case b.MIDDLE_LEFT:e=d;break;case b.MIDDLE_RIGHT:e=d;break;case b.BOTTOM_LEFT:e=c;break;case b.BOTTOM_CENTER:e=c;break;case b.BOTTOM_RIGHT:e=c;break;default:}return e},c.prototype.setX=function(a){this.setTransform({x:a}),this._x=a},c.prototype.getX=function(){return this._x},c.prototype.setY=function(a){this.setTransform({y:a}),this._y=a},c.prototype.getY=function(){return this._y},c.prototype.setScaleX=function(a){this.setTransform({scaleX:a})},c.prototype.getScaleX=function(){return this._transform.scaleX},c.prototype.setScaleY=function(a){this.setTransform({scaleY:a})},c.prototype.getScaleY=function(){return this._transform.scaleY},c.prototype.setRotate=function(a){this.setTransform({rotate:a})},c.prototype.getRotate=function(){return this._transform.rotate};var e={};e.tmpParent=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.tmpParent.setAttribute("width",0),e.tmpParent.setAttribute("height",0),e.tmpParent.id="SVGSpriteTmpParent",e.EventDispatcher=function(a){this.svgElement=a},e.EventDispatcher.prototype.addEventListener=function(a,b,c){c=c?!0:!1,this._originalElement.addEventListener(a,b,c)},e.EventDispatcher.prototype.removeEventListener=function(a,b,c){c=c?!0:!1,this._originalElement.removeEventListener(a,b,c)},e.DisplayObject=function(a){this.constructor(a)},e.DisplayObject.prototype=new e.EventDispatcher,d(e.DisplayObject.prototype,"svgElement",function(a){if(typeof this._svgElement=="undefined"&&a){var b=a;if(typeof a=="string"){var d=document.getElementById(a);if(d)b=d;else{var f=document.getElementsByTagName("object");for(var g=0;g<f.length;g++)f[g].type==="image/svg+xml"&&(b=f[g].contentDocument.getElementById(a))}}if(!b||b.namespaceURI!=="http://www.w3.org/2000/svg")throw new Error("引数が SVG Element ではありません。");this.__prefix=typeof b.prefix=="string"?b.prefix+":":"",b.parentNode==null&&(document.body.appendChild(e.tmpParent),e.tmpParent.appendChild(b)),this._svgTransformUtil=new c(b),this._originalElement=this._svgTransformUtil.sourceSVGElement,this._svgElement=document.createElementNS("http://www.w3.org/2000/svg",this.__prefix+"g"),this._svgElement.setAttribute("class","SVGSprite"),this._oapcityElement=document.createElementNS("http://www.w3.org/2000/svg",this.__prefix+"g"),this._oapcityElement.setAttribute("class","SVGSpriteOpacityWrapper"),this._svgTransformUtil.sourceSVGElement.parentNode.replaceChild(this._oapcityElement,this._svgTransformUtil.sourceSVGElement),this._oapcityElement.appendChild(this._svgTransformUtil.sourceSVGElement),this._svgTransformUtil.svgElement.parentNode.replaceChild(this._svgElement,this._svgTransformUtil.svgElement),this._svgElement.appendChild(this._svgTransformUtil.svgElement),this.sourceSVGElement=b,this.buttonMode=!1}},function(){return this._svgElement}),d(e.DisplayObject.prototype,"_prefix",function(){throw new Error("参照専用です。")},function(){return this.__prefix}),e.DisplayObject.prototype._getViewPortScaleX=function(){var a=this._svgElement.nearestViewportElement.viewBox.baseVal.width,b=this._svgElement.nearestViewportElement.width.baseVal.value;return a==0?1:b/a},d(e.DisplayObject.prototype,"_viewPortScaleX",function(){throw new Error("参照専用です。")},function(){return this._getViewPortScaleX()}),e.DisplayObject.prototype._getViewPortScaleY=function(){var a=this._svgElement.nearestViewportElement.viewBox.baseVal.height,b=this._svgElement.nearestViewportElement.height.baseVal.value;return a==0?1:b/a},d(e.DisplayObject.prototype,"_viewPortScaleY",function(){throw new Error("参照専用です。")},function(){return this._getViewPortScaleY()}),d(e.DisplayObject.prototype,"x",function(a){this._svgTransformUtil.setX(a)},function(){return this._svgTransformUtil.getX()}),d(e.DisplayObject.prototype,"y",function(a){this._svgTransformUtil.setY(a)},function(){return this._svgTransformUtil.getY()}),d(e.DisplayObject.prototype,"width",function(a){this.scaleX=a/this._svgTransformUtil.origWidth},function(){return this._svgTransformUtil.getWidth()}),d(e.DisplayObject.prototype,"height",function(a){this.scaleY=a/this._svgTransformUtil.origHeight},function(){return this._svgTransformUtil.getHeight()}),d(e.DisplayObject.prototype,"scaleX",function(a){this._svgTransformUtil.setScaleX(a)},function(){return this._svgTransformUtil.getScaleX()}),d(e.DisplayObject.prototype,"scaleY",function(a){this._svgTransformUtil.setScaleY(a)},function(){return this._svgTransformUtil.getScaleY()}),d(e.DisplayObject.prototype,"rotation",function(a){this._svgTransformUtil.setRotate(a)},function(){return this._svgTransformUtil.getRotate()}),e.DisplayObject.prototype._getAlpha=function(){var a=this._oapcityElement.getAttribute("opacity");return Number(typeof a=="string"?a:1)},d(e.DisplayObject.prototype,"alpha",function(a){var b=Number(a);0<=b&&b<=1&&this._oapcityElement.setAttribute("opacity",b)},function(){return this._getAlpha()}),d(e.DisplayObject.prototype,"buttonMode",function(a){this._buttonMode=Boolean(a),this._buttonMode?this.svgElement.setAttributeNS(null,"style","cursor: move"):this.svgElement.setAttributeNS(null,"style","cursor: normal")},function(){return this._buttonMode}),e.DisplayObjectContainer=function(a){this.constructor(a)},e.DisplayObjectContainer.prototype=new e.DisplayObject,e.DisplayObjectContainer.prototype.addChild=function(a){throw new Error("未実装です。")},e.DisplayObjectContainer.prototype.appendTo=function(a){a.appendChild(this.svgElement)},e.Sprite=function(a){this.constructor(a)},e.Sprite.prototype=new e.DisplayObjectContainer,e.Sprite.prototype.startDrag=function(a,b){this.svgElement.ownerSVGElement.addEventListener("mousedown",function(a){a.preventDefault()},!1),typeof b!="undefined"&&b!=null&&!isNaN(b.x)&&!isNaN(b.y)&&!isNaN(b.width)&&!isNaN(b.height)?(this._bounds=b,this._bounds.left=this._bounds.x,this._bounds.right=this._bounds.x+this._bounds.width,this._bounds.top=this._bounds.y,this._bounds.bottom=this._bounds.y+this._bounds.height):this._bounds=null,e.Sprite.drag.startDrag(this)},e.Sprite.prototype.stopDrag=function(){e.Sprite.drag.stopDrag()},e.Sprite.drag={target:null,origX:0,origY:0,origMouseX:null,origMouseY:null},e.Sprite.drag.startDrag=function(a){this.target=a,this.origX=a.x,this.origY=a.y,e.Sprite.drag.target.svgElement.ownerSVGElement.addEventListener("mousemove",e.Sprite.drag._doDrag,!0)},e.Sprite.drag._doDrag=function(a){var b=e.Sprite.drag;b.origMouseX==null&&(b.origMouseX=a.clientX,b.origMouseY=a.clientY);var c=(a.clientX-b.origMouseX)/b.target._viewPortScaleX+b.origX,d=(a.clientY-b.origMouseY)/b.target._viewPortScaleY+b.origY;b.target._bounds!=null&&(c=c<b.target._bounds.left?b.target._bounds.left:c+b.target.width>b.target._bounds.right?b.target._bounds.right-b.target.width:c,d=d<b.target._bounds.top?b.target._bounds.top:d+b.target.height>b.target._bounds.bottom?b.target._bounds.bottom-b.target.height:d),b.target.x=c,b.target.y=d},e.Sprite.drag.stopDrag=function(){var a=e.Sprite.drag;e.Sprite.drag.target!=null&&e.Sprite.drag.target.svgElement.ownerSVGElement.removeEventListener("mousemove",e.Sprite.drag._doDrag,!0),a.target=null,a.origX=0,a.origY=0,a.origMouseX=null,a.origMouseY=null},a.SVGSprite=e})(this)